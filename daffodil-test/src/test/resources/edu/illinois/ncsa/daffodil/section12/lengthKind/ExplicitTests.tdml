<?xml version="1.0" encoding="UTF-8"?>
<tdml:testSuite suiteName="ExplicitTests"
	description="Section 12 - lengthKind=explicit" xmlns:tdml="http://www.ibm.com/xmlns/dfdl/testData"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/"
	xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ct="http://w3.ibm.com/xmlns/dfdl/ctInfoset"
	xmlns:ex="http://example.com">

	<tdml:defineSchema name="lengthKind_explicit">

		<dfdl:format ref="ex:daffodilTest1" />

		<xs:element name="address" dfdl:lengthKind="implicit">
			<xs:complexType>
				<xs:sequence dfdl:sequenceKind="ordered">
					<xs:element name="houseNumber" type="xs:string"
						dfdl:lengthKind="explicit" dfdl:length="6" />
					<xs:element name="street" type="xs:string"
						dfdl:lengthKind="explicit" dfdl:length="20" />
					<xs:element name="city" type="xs:string"
						dfdl:lengthKind="explicit" dfdl:length="20" />
					<xs:element name="state" type="xs:string"
						dfdl:lengthKind="explicit" dfdl:length="2" />
				</xs:sequence>
			</xs:complexType>
		</xs:element>

	</tdml:defineSchema>

	<tdml:parserTestCase name="Lesson1_lengthKind_explicit"
		root="address" model="lengthKind_explicit" description="lengthKind='explicit' - DFDL-12-039R">
		<tdml:document><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<address>
					<houseNumber>000118</houseNumber>
					<street>Ridgewood Circle</street>
					<city>Rochester</city>
					<state>NY</state>
				</address>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>
	
	 <tdml:defineSchema name="test_ExplicitLengthBits">

    <dfdl:format ref="ex:daffodilTest1" />

    <xs:element name="notFixed">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="len" type="xs:int"
            dfdl:representation="binary" dfdl:lengthKind="implicit" />
          <xs:element name="address" dfdl:lengthKind="explicit"
            dfdl:length="{ ../ex:len }" dfdl:lengthUnits="bits">
            <xs:complexType>
              <xs:sequence dfdl:sequenceKind="ordered">
                <xs:element name="houseNumber" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
                <xs:element name="street" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="city" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="state" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:complexType>
    </xs:element>
    
    <xs:element name="fixed">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="address" dfdl:lengthKind="explicit"
            dfdl:length="48" dfdl:lengthUnits="bits">
            <xs:complexType>
              <xs:sequence dfdl:sequenceKind="ordered">
                <xs:element name="houseNumber" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
                <xs:element name="street" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="city" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="state" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:complexType>
    </xs:element>


  </tdml:defineSchema>

  <tdml:parserTestCase name="test_ExplicitLengthBitsNotFixed"
    root="notFixed" model="test_ExplicitLengthBits" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="byte">00000180
      </tdml:documentPart>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <notFixed>
          <len>384</len>
          <address>
            <houseNumber>000118</houseNumber>
            <street>Ridgewood Circle</street>
            <city>Rochester</city>
            <state>NY</state>
          </address>
        </notFixed>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  <tdml:parserTestCase name="test_ExplicitLengthBitsFixed"
    root="fixed" model="test_ExplicitLengthBits" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <fixed>
          <address>
            <houseNumber>000118</houseNumber>
            <street>Ridgewood Circle</street>
            <city>Rochester</city>
            <state>NY</state>
          </address>
        </fixed>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

	<tdml:defineSchema name="test_ExplicitLengthBytes">

		<dfdl:format ref="ex:daffodilTest1" />

		<xs:element name="notFixed">
			<xs:complexType>
				<xs:sequence>
					<xs:element name="len" type="xs:int"
						dfdl:representation="binary" dfdl:lengthKind="implicit" />
					<xs:element name="address" dfdl:lengthKind="explicit"
						dfdl:length="{ ../ex:len }" dfdl:lengthUnits="bytes">
						<xs:complexType>
							<xs:sequence dfdl:sequenceKind="ordered">
								<xs:element name="houseNumber" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
								<xs:element name="street" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
								<xs:element name="city" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
								<xs:element name="state" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
							</xs:sequence>
						</xs:complexType>
					</xs:element>
				</xs:sequence>
			</xs:complexType>
		</xs:element>
		
		<xs:element name="fixed">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="address" dfdl:lengthKind="explicit"
            dfdl:length="48" dfdl:lengthUnits="bytes">
            <xs:complexType>
              <xs:sequence dfdl:sequenceKind="ordered">
                <xs:element name="houseNumber" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
                <xs:element name="street" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="city" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="state" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="broken">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="address" dfdl:lengthKind="explicit"
            dfdl:lengthUnits="bytes">
            <xs:complexType>
              <xs:sequence dfdl:sequenceKind="ordered">
                <xs:element name="houseNumber" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
                <xs:element name="street" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="city" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="state" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="int" type="xs:int"
      dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
    <xs:element name="string" type="xs:string"
      dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />

    <xs:element name="choiceRef">
			<xs:complexType>
				<xs:sequence>
					<xs:element name="len" type="xs:int"
						dfdl:representation="binary" dfdl:lengthKind="implicit" />
					<xs:element name="address" dfdl:lengthKind="explicit"
						dfdl:length="{ ../ex:len }" dfdl:lengthUnits="bytes">
            <xs:complexType>
							<xs:sequence dfdl:sequenceKind="ordered">
								<xs:element name="houseNumber" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
								<xs:element name="street" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
								<xs:element name="city" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
								<xs:element name="state" type="xs:string"
									dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
                <xs:choice>
                  <xs:element ref="ex:int" />
                  <xs:element ref="ex:string" />
                </xs:choice>
							</xs:sequence>
						</xs:complexType>
					</xs:element>
				</xs:sequence>
			</xs:complexType>
		</xs:element>

	</tdml:defineSchema>

	<tdml:parserTestCase name="test_ExplicitLengthBytesNotFixed"
		root="notFixed" model="test_ExplicitLengthBytes" description="lengthKind='explicit' - DFDL-12-039R">
		<tdml:document>
			<tdml:documentPart type="byte">00000030
			</tdml:documentPart>
			<tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
		</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<notFixed>
					<len>48</len>
					<address>
						<houseNumber>000118</houseNumber>
						<street>Ridgewood Circle</street>
						<city>Rochester</city>
						<state>NY</state>
					</address>
				</notFixed>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>
	
	<tdml:parserTestCase name="test_ExplicitLengthBytesFixed"
    root="fixed" model="test_ExplicitLengthBytes" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <fixed>
          <address>
            <houseNumber>000118</houseNumber>
            <street>Ridgewood Circle</street>
            <city>Rochester</city>
            <state>NY</state>
          </address>
        </fixed>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:parserTestCase name="test_ExplicitLengthBytesBroken"
    root="broken" model="test_ExplicitLengthBytes" description="lengthKind='explicit' without dfdl:lenght being set - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
    </tdml:document>
    <tdml:errors>
      <tdml:error>Schema Definition Error</tdml:error>
    </tdml:errors>
  </tdml:parserTestCase>

  <tdml:parserTestCase name="test_ExplicitLengthBytesChoiceRef"
    root="choiceRef" model="test_ExplicitLengthBytes" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="byte">00000033</tdml:documentPart>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY123]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <choiceRef>
					<len>51</len>
          <address>
            <houseNumber>000118</houseNumber>
            <street>Ridgewood Circle</street>
            <city>Rochester</city>
            <state>NY</state>
            <int>123</int>
          </address>
        </choiceRef>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:parserTestCase name="test_ExplicitLengthBytesNotGiven"
    root="choiceRef" model="test_ExplicitLengthBytes" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY123]]></tdml:documentPart>
    </tdml:document>
    <tdml:errors>
      <tdml:error>Parse Error: StringFixedLengthInBytesFixedWidthCharacters - Insufficient Bits in field: IndexOutOfBounds</tdml:error>
    </tdml:errors>
  </tdml:parserTestCase>

	 <tdml:defineSchema name="test_ExplicitLengthChars">

    <dfdl:format ref="ex:daffodilTest1" />

    <xs:element name="notFixed">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="len" type="xs:int"
            dfdl:representation="binary" dfdl:lengthKind="implicit" />
          <xs:element name="address" dfdl:lengthKind="explicit"
            dfdl:length="{ ../ex:len }" dfdl:lengthUnits="characters">
            <xs:complexType>
              <xs:sequence dfdl:sequenceKind="ordered">
                <xs:element name="houseNumber" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
                <xs:element name="street" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="city" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="state" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:complexType>
    </xs:element>
    
    <xs:element name="fixed">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="address" dfdl:lengthKind="explicit"
            dfdl:length="48" dfdl:lengthUnits="characters">
            <xs:complexType>
              <xs:sequence dfdl:sequenceKind="ordered">
                <xs:element name="houseNumber" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 6 }" />
                <xs:element name="street" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="city" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 20 }" />
                <xs:element name="state" type="xs:string"
                  dfdl:lengthKind="explicit" dfdl:length="{ 2 }" />
              </xs:sequence>
            </xs:complexType>
          </xs:element>
        </xs:sequence>
      </xs:complexType>
    </xs:element>


  </tdml:defineSchema>

  <tdml:parserTestCase name="test_ExplicitLengthCharsNotFixed"
    root="notFixed" model="test_ExplicitLengthChars" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="byte">00000030
      </tdml:documentPart>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <notFixed>
          <len>48</len>
          <address>
            <houseNumber>000118</houseNumber>
            <street>Ridgewood Circle</street>
            <city>Rochester</city>
            <state>NY</state>
          </address>
        </notFixed>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  <tdml:parserTestCase name="test_ExplicitLengthCharsFixed"
    root="fixed" model="test_ExplicitLengthChars" description="lengthKind='explicit' - DFDL-12-039R">
    <tdml:document>
      <tdml:documentPart type="text"><![CDATA[000118Ridgewood Circle    Rochester           NY]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <fixed>
          <address>
            <houseNumber>000118</houseNumber>
            <street>Ridgewood Circle</street>
            <city>Rochester</city>
            <state>NY</state>
          </address>
        </fixed>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

</tdml:testSuite>
