<?xml version="1.0" encoding="UTF-8"?>
<tdml:testSuite suiteName="BitOrder"
  description="new property bitOrder='leastSignificantBitFirst'" xmlns:tdml="http://www.ibm.com/xmlns/dfdl/testData"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/"
  xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ex="http://example.com"
  xmlns:tns="http://example.com">


  <tdml:defineSchema name="s">
    <dfdl:format ref="ex:daffodilTest1" representation="binary"
      lengthUnits="bits" bitOrder='leastSignificantBitFirst' lengthKind='explicit'
      byteOrder='littleEndian' alignmentUnits='bits' alignment='1'/>

    <xs:element name="tabBI" dfdl:lengthKind='implicit' >
      <xs:complexType>
        <xs:sequence>
          <xs:element name="Version" type="xs:unsignedInt"
            dfdl:length="4" />
          <xs:element name="FPI" type="xs:unsignedInt" dfdl:length="1" />
          <xs:element name="GPI_OriginatorAddress" type="xs:unsignedInt"
            dfdl:length="1" />
          <xs:element name="FPI_URN" type="xs:unsignedInt"
            dfdl:length="1" />
          <xs:element name="URN" type="xs:unsignedInt" dfdl:length="24" />
          <xs:element name="FPI_UnitName" type="xs:unsignedInt"
            dfdl:length="1" />
          <xs:element name="UnitName" type="xs:string" dfdl:encoding="us-ascii-7-bit-packed"
            dfdl:lengthKind="delimited" dfdl:terminator="&#x7F;" />
          <xs:element name="GPI_RecipAddrGroup" type="xs:unsignedInt"
            dfdl:length="1" />
          <xs:element name="GRI_R1" type="xs:unsignedInt"
            dfdl:length="1" />
          <xs:element name="FPI_URN2" type="xs:unsignedInt"
            dfdl:length="1" />
          <xs:element name="URN2" type="xs:unsignedInt" dfdl:length="24" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>
    
    <xs:element name="ver" dfdl:lengthKind='implicit'>
      <xs:complexType>
        <xs:sequence>
          <xs:element name="URN" type="xs:unsignedInt" dfdl:length="24" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>
    
    <xs:element name="span3Bytes" dfdl:lengthKind='implicit'>
      <xs:complexType>
        <xs:sequence>
          <xs:element name="before" type="xs:unsignedInt" dfdl:length="5" />
          <xs:element name="middle" type="xs:unsignedInt" dfdl:length="13" />
          <xs:element name="after" type="xs:unsignedInt" dfdl:length="6" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>
    

  </tdml:defineSchema>

 <tdml:parserTestCase name="TestMIL2045_47001D_1"
    root="ver" model="s" description="Verification that user's test works for DFDL-677">
    <document bitOrder="LSBFirst" xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" byteOrder="RTL">URN  X0000000 00000000 01100111 1XXX XXXX</documentPart>      
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <ver>
          <URN>207</URN>
        </ver>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>


  <tdml:parserTestCase name="TestMIL2045_47001D_Page70_TableB_I_with_string"
    root="tabBI" model="s" description="Verification that user's test works for DFDL-677">
    <document bitOrder="LSBFirst" xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" byteOrder="RTL">Version                         XXXX 0011</documentPart>
      <documentPart type="bits" byteOrder="RTL">FPI                             XXX0 XXXX</documentPart>
      <documentPart type="bits" byteOrder="RTL">Compression                     NA       </documentPart>
      <documentPart type="bits" byteOrder="RTL">GPI for Originator Address      XX1X XXXX</documentPart>
      <documentPart type="bits" byteOrder="RTL">FPI for URN                     X1XX XXXX</documentPart>
      <documentPart type="bits" byteOrder="RTL">URN  X0000000 00000000 01100111 1XXX XXXX</documentPart>
      <documentPart type="bits" byteOrder="RTL">FPI for Unit Name               1XXX XXXX</documentPart>
      <documentPart type="text" encoding="us-ascii-7-bit-packed">UNITA&#x7F;</documentPart>
      <documentPart type="bits" byteOrder="RTL">GPI for Recip. Addr Group       XXXX X1XX</documentPart>
      <documentPart type="bits" byteOrder="RTL">GRI for R_ONE                   XXXX 0XXX</documentPart>
      <documentPart type="bits" byteOrder="RTL">FPI for URN                     XXX1 XXXX</documentPart>
      <documentPart type="bits" byteOrder="RTL">URN XXXX00000 00000000 00000000 011X XXXX</documentPart>
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <tabBI>
          <Version>3</Version>
          <FPI>0</FPI>
          <GPI_OriginatorAddress>1</GPI_OriginatorAddress>
          <FPI_URN>1</FPI_URN>
          <URN>207</URN>
          <FPI_UnitName>1</FPI_UnitName>
          <UnitName>UNITA</UnitName>
          <GPI_RecipAddrGroup>1</GPI_RecipAddrGroup>
          <GRI_R1>0</GRI_R1>
          <FPI_URN2>1</FPI_URN2>
          <URN2>3</URN2>
        </tabBI>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

 <tdml:parserTestCase name="TestLSBFirstSpan3Bytes"
    root="span3Bytes" model="s" description="13 bits from the middle of a 24 bit field">
    <document bitOrder="LSBFirst" xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" byteOrder="RTL">010110|10 00110111 011|10001</documentPart>      
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <span3Bytes>
          <before>17</before>
          <middle>4539</middle>
          <after>22</after>
        </span3Bytes>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:defineSchema name="s2">
    <dfdl:format ref="ex:daffodilTest1" representation="binary"
      lengthUnits="bits" bitOrder='leastSignificantBitFirst' lengthKind='explicit'
      alignmentUnits='bits' alignment='1' binaryNumberRep='binary'/>

    <xs:element name="leastFirst" dfdl:lengthKind='implicit'>
      <xs:complexType>
        <xs:sequence>
          <xs:element name="A" type="xs:int" dfdl:length="3" />
          <xs:element name="B" type="xs:int" dfdl:length="7" />
          <xs:element name="C" type="xs:int" dfdl:length="4" />
          <xs:element name="D" type="xs:int" dfdl:length="2" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </tdml:defineSchema>

<!--
     Test Name: leastSignificantBitFirst
        Schema: s2
          Root: leastFirst
       Purpose: This test shows the bit order of 'leastSignificantBitFirst'.
-->
 <tdml:parserTestCase name="leastSignificantBitFirst"
    root="leastFirst" model="s2" description="Tests the bit order of 'leastSignificantBitFirst'">
    <document xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" >01001|011 01|0101|00</documentPart>
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <leastFirst>
          <A>3</A>
          <B>9</B>
          <C>5</C>
          <D>1</D>
        </leastFirst>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

<!--
     Test Name: leastSignificantBitFirstRTL
        Schema: s2
          Root: leastFirst
       Purpose: This test shows the bit order of 'leastSignificantBitFirst' with a byte order of right to left.
-->
 <tdml:parserTestCase name="leastSignificantBitFirstRTL" root="leastFirst" model="s2"
    description="Tests the bit order of 'leastSignificantBitFirst' with byte order of right to left">
    <document bitOrder="LSBFirst" xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" byteOrder="RTL">01|0101|00 01001|011</documentPart>
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <leastFirst>
          <A>3</A>
          <B>9</B>
          <C>5</C>
          <D>1</D>
        </leastFirst>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:defineSchema name="s3">
    <dfdl:format ref="ex:daffodilTest1" representation="binary"
      lengthUnits="bits" bitOrder='mostSignificantBitFirst' lengthKind='explicit'
      alignmentUnits='bits' alignment='1' binaryNumberRep='binary'/>

    <xs:element name="mostFirst" dfdl:lengthKind='implicit'>
      <xs:complexType>
        <xs:sequence>
          <xs:element name="A" type="xs:int" dfdl:length="3" />
          <xs:element name="B" type="xs:int" dfdl:length="7" />
          <xs:element name="C" type="xs:int" dfdl:length="4" />
          <xs:element name="D" type="xs:int" dfdl:length="2" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </tdml:defineSchema>

<!--
     Test Name: mostSignificantBitFirst
        Schema: s3
          Root: mostFirst
       Purpose: This test shows the bit order of 'mostSignificantBitFirst'.
-->
 <tdml:parserTestCase name="mostSignificantBitFirst"
    root="mostFirst" model="s3" description="Tests the bit order of 'mostSignificantBitFirst'">
    <document xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" >011|00010 01|0101|01</documentPart>
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <mostFirst>
          <A>3</A>
          <B>9</B>
          <C>5</C>
          <D>1</D>
        </mostFirst>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:defineSchema name="s4">
    <dfdl:format ref="ex:daffodilTest1" representation="binary" lengthUnits="bytes"
      lengthKind='explicit' alignmentUnits='bytes' alignment='1' binaryNumberRep='binary' />

      <xs:element name="littleLeast" type="xs:hexBinary" dfdl:byteOrder="littleEndian"
        dfdl:representation="binary" dfdl:bitOrder='leastSignificantBitFirst' dfdl:length="3"/>

  </tdml:defineSchema>

  <!--
     Test Name: littleEndianLeastFirstLTR
        Schema: s4
          Root: littleLeast
       Purpose: This test shows the bit order of 'leastSignificantBitFirst' with a byteOrder of 'littleEndian' with bytes left to right.
  -->
 <tdml:parserTestCase name="littleEndianLeastFirstLTR" root="littleLeast" model="s4"
    description="Tests the bit order of 'leastSignificantBitFirst' with byteOrder of 'littleEndian' with bytes left to right">
    <document bitOrder="LSBFirst" xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" byteOrder="LTR">01011010 10010010 00000000</documentPart>
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <littleLeast>5A9200</littleLeast>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <!--
     Test Name: littleEndianLeastFirstRTL
        Schema: s4
          Root: littleLeast
       Purpose: This test shows the bit order of 'leastSignificantBitFirst' with a byteOrder of 'littleEndian' with bytes right to left.
  -->
 <tdml:parserTestCase name="littleEndianLeastFirstRTL" root="littleLeast" model="s4"
    description="Tests the bit order of 'leastSignificantBitFirst' with byteOrder of 'littleEndian' with bytes right to left">
    <document bitOrder="LSBFirst" xmlns="http://www.ibm.com/xmlns/dfdl/testData" >
      <documentPart type="bits" byteOrder="RTL">01011010 10010010 00000000</documentPart>
    </document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://example.com">
        <littleLeast>00925A</littleLeast>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

</tdml:testSuite>
