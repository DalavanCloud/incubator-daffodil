<?xml version="1.0" encoding="UTF-8"?>
<tdml:testSuite suiteName="InitiatedContent" description="Section 15 - ChoiceGroups"
	xmlns:tdml="http://www.ibm.com/xmlns/dfdl/testData" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/" xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xmlns:ex="http://example.com" xmlns:ct="http://w3.ibm.com/xmlns/dfdl/ctInfoset"
	xsi:schemaLocation="http://www.ibm.com/xmlns/dfdl/testData /xsd/tdml.xsd">

	<tdml:defineSchema name="s1">
		<dfdl:format ref="ex:daffodilTest1" />

		<xs:element name="e1" dfdl:lengthKind="implicit">
			<xs:complexType>
				<xs:sequence>
					<xs:element name="s" dfdl:lengthKind="implicit"
						minOccurs="0" maxOccurs="unbounded" dfdl:occursCountKind='parsed'>
						<xs:complexType>
							<xs:choice dfdl:initiatedContent="yes"
								dfdl:separatorPosition="infix" dfdl:separator="">
								<xs:element name="s1" dfdl:initiator="[s1:" type="xs:int"
									dfdl:terminator="]" dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
								<xs:element name="s2" dfdl:initiator="[s2:" type="xs:string"
									dfdl:terminator="]" dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
							</xs:choice>
						</xs:complexType>
					</xs:element>
				</xs:sequence>
			</xs:complexType>
		</xs:element>

		<xs:element name="e2" dfdl:lengthKind="implicit">
			<xs:complexType>
				<xs:sequence>
					<xs:choice>
						<xs:element name="x1" dfdl:lengthKind="implicit">
							<xs:complexType>
								<xs:choice dfdl:initiatedContent="yes"
									dfdl:separatorPosition="infix" dfdl:separator="">
									<xs:element name="a1" dfdl:initiator="[" type="xs:int"
										dfdl:terminator="]" dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
									<xs:element name="a2" dfdl:initiator="[" type="xs:string"
										dfdl:terminator="]" dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
								</xs:choice>
							</xs:complexType>
						</xs:element>
						<xs:element name="x2" type="xs:string" dfdl:lengthKind="delimited" />
					</xs:choice>
				</xs:sequence>
			</xs:complexType>
		</xs:element>
		
		<xs:element name="e2WithoutInitiatedContent" dfdl:lengthKind="implicit">
			<xs:complexType>
				<xs:sequence>
					<xs:choice>
						<xs:element name="x1" dfdl:lengthKind="implicit">
							<xs:complexType>
								<xs:choice dfdl:initiatedContent="no"
									dfdl:separatorPosition="infix" dfdl:separator="">
									<xs:element name="a1" dfdl:initiator="[" type="xs:int"
										dfdl:terminator="]" dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
									<xs:element name="a2" dfdl:initiator="[" type="xs:string"
										dfdl:terminator="]" dfdl:lengthKind="explicit" dfdl:length="{ 3 }" />
								</xs:choice>
							</xs:complexType>
						</xs:element>
						<xs:element name="x2" type="xs:string" dfdl:lengthKind="delimited" />
					</xs:choice>
				</xs:sequence>
			</xs:complexType>
		</xs:element>
		
	</tdml:defineSchema>

	<tdml:parserTestCase name="initiatedContent1"
		model="s1" root="e1">
		<tdml:document>[s2:abc][s1:123]</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e1>
					<s>
						<s2>abc</s2>
					</s>
					<s>
						<s1>123</s1>
					</s>
				</e1>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="initiatedContent2"
		model="s1" root="e1">
		<tdml:document>[s2:abc][s1:noi]</tdml:document>
		<tdml:errors>
			<tdml:error>[s1:noi]</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="initiatedContent3"
		description="test that insures initiatedContent the initiator behaves as a discriminator and cuts off other choice alternatives."
		model="s1" root="e2">
		<tdml:document>[abc]</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e2>
					<x2>[abc]</x2>
				</e2>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>
	
	<tdml:parserTestCase name="initiatedContent4"
		description="test that insures initiatedContent the initiator behaves as a discriminator and cuts off other choice alternatives."
		model="s1" root="e2WithoutInitiatedContent">
		<tdml:document>[abc]</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e2WithoutInitiatedContent>
					<x1><a2>abc</a2></x1>
				</e2WithoutInitiatedContent>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>


</tdml:testSuite>