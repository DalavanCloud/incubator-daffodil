<?xml version="1.0" encoding="UTF-8"?>
<testSuite suiteName="escapeScheme" xmlns="http://www.ibm.com/xmlns/dfdl/testData"
  xmlns:tns="http://example.com" xmlns:ct="http://w3.ibm.com/xmlns/dfdl/ctInfoset"
  xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/" xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <defineSchema name="es1">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />

    <dfdl:defineEscapeScheme name="pound">
      <dfdl:escapeScheme escapeCharacter='#'
        escapeKind="escapeCharacter" escapeEscapeCharacter="" />
    </dfdl:defineEscapeScheme>
    <dfdl:defineEscapeScheme name='cStyleComment'>
      <dfdl:escapeScheme escapeBlockStart='/*'
        escapeBlockEnd='*/' escapeKind="escapeBlock"
        escapeEscapeCharacter="" />
    </dfdl:defineEscapeScheme>

    <xs:element name="list1">
      <xs:complexType>
        <xs:sequence dfdl:initiatedContent="no"
          dfdl:separatorPosition="infix" dfdl:sequenceKind="ordered"
          dfdl:separator=",">
          <xs:element name="character" type="xs:string">
            <xs:annotation>
              <xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
                <dfdl:element escapeSchemeRef="tns:pound"/>
              </xs:appinfo>
            </xs:annotation>
          </xs:element>
          <xs:element name="block" type="xs:string"
            dfdl:escapeSchemeRef="tns:cStyleComment" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>
  </defineSchema>
  
  <defineSchema name="es2">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />
      <xs:element name="elem" dfdl:defineEscapeScheme=""/>
  </defineSchema>

  <defineSchema name="es4">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />
      <xs:element name="elem"/>
  </defineSchema>

  <defineSchema name="es5">
    <dfdl:format ref="tns:daffodilTest1" lengthKind="delimited" />
    <dfdl:defineEscapeScheme>
      <dfdl:escapeScheme escapeCharacter='#'
        escapeKind="escapeCharacter" escapeEscapeCharacter="" />
    </dfdl:defineEscapeScheme>
    <xs:element name="elem" type="xs:int"/>
  </defineSchema>

  <parserTestCase name="escapeSchemeSimple" model="es1"
    description="Section 7 defineEscapeScheme - DFDL-7-079R" root="list1">
    <document><![CDATA[ab#,cd,/*ef,gh*/]]></document>
    <infoset>
      <dfdlInfoset>
        <list1>
          <character>ab,cd</character>
          <block>ef,gh</block>
        </list1>
      </dfdlInfoset>
    </infoset>
  </parserTestCase>

  <!--
       Test Name: escapeSchemeFail
          Schema: es2
            Root: elem
         Purpose: This is a negative test to demonstrate that defineEscapeScheme cannot be used within an element tag
  -->

  <parserTestCase name="escapeSchemeFail" model="es2"
    description="Section 7 defineEscapeScheme - DFDL-7-087R" root="elem">
    <document><![CDATA[123]]></document>
    <errors>
      <error>Schema Definition Error</error>
    </errors>
  </parserTestCase>
  
  <!--
       Test Name: escapeSchemeFail2
          Schema: es5
            Root: elem
         Purpose: This is a negative test to demonstrate that "name" is a required attribute of the defineEscapeScheme tag 
  -->

  <parserTestCase name="escapeSchemeFail2" model="es5"
    description="Section 7 defineEscapeScheme - DFDL-7-082R" root="elem">
    <document><![CDATA[123]]></document>
    <errors>
      <error>Schema Definition Error</error>
    </errors>
  </parserTestCase>

</testSuite>
