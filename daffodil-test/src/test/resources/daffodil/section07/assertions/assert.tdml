<?xml version="1.0" encoding="UTF-8"?>
<tdml:testSuite suiteName="Assert" description="Section 7 - Assert"
	xmlns:ex="http://example.com" xmlns="http://example.com"
	xmlns:tdml="http://www.ibm.com/xmlns/dfdl/testData" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/" xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xmlns:ct="http://w3.ibm.com/xmlns/dfdl/ctInfoset" xsi:schemaLocation="http://www.ibm.com/xmlns/dfdl/testData /xsd/tdml.xsd">

	<tdml:defineSchema name="s1">
		<dfdl:format ref="ex:daffodilTest1" />
		<xs:element name="e1" type="xs:int" dfdl:inputValueCalc="{ 42 }">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert><![CDATA[{ xs:int(.) eq 42 }]]></dfdl:assert>
				</xs:appinfo>
			</xs:annotation>
		</xs:element>

		<xs:element name="e2" type="xs:int" dfdl:inputValueCalc="{ 43 }">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert><![CDATA[{ xs:int(.) eq 42 }]]></dfdl:assert>
				</xs:appinfo>
			</xs:annotation>
		</xs:element>

		<xs:element name="e3"><!-- like e2, but assert uses a path to a peer 
				element -->
			<xs:complexType>
				<xs:sequence>
					<xs:element name="v" type="xs:int" dfdl:inputValueCalc="{ 42 }" />
					<xs:element name="a" type="xs:string"
						dfdl:inputValueCalc="{ 'ok' }">
						<xs:annotation>
							<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
								<dfdl:assert><![CDATA[{ xs:int(../ex:v) ne 42 }]]></dfdl:assert>
							</xs:appinfo>
						</xs:annotation>
					</xs:element>
				</xs:sequence>
			</xs:complexType>
		</xs:element>

		<xs:element name="e4" type="xs:int" dfdl:lengthKind="delimited">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert testKind="pattern" testPattern="\d\d"
						message="Assertion failed for pattern '\d\d'" />
				</xs:appinfo>
			</xs:annotation>
		</xs:element>

		<xs:element name="e5" type="xs:int" dfdl:lengthKind="delimited">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert testKind="pattern" testPattern="\d\d\d"
						message="Assertion failed for pattern '\d\d\d'" />
				</xs:appinfo>
			</xs:annotation>
		</xs:element>

		<xs:element name="e6" type="xs:int" dfdl:lengthKind="pattern"
			dfdl:lengthPattern="\d\d" dfdl:terminator=": ,">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert testKind="pattern" testPattern="\d\d"
						message="Assertion failed for pattern '\d\d'" />
					<dfdl:assert testKind="pattern" testPattern="\d\d:"
						message="Assertion failed for pattern '\d\d:'" />
				</xs:appinfo>
			</xs:annotation>
		</xs:element>
		
		<xs:element name="e7" type="xs:string" dfdl:lengthKind="delimited">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert testKind="pattern" testPattern="\p{L}{2,5}"
						message="Assertion failed for pattern '\p{L}{2,5}'" />
				</xs:appinfo>
			</xs:annotation>
		</xs:element>
		
		<xs:element name="e8" type="xs:string" dfdl:lengthKind="pattern" dfdl:lengthPattern="\p{L}{2,5}">
			<xs:annotation>
				<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
					<dfdl:assert testKind="pattern" testPattern="\p{L}{2,5}"
						message="Assertion failed for pattern '\p{L}{2,5}'" />
				</xs:appinfo>
			</xs:annotation>
		</xs:element>

	</tdml:defineSchema>


	<tdml:parserTestCase name="assertPass" root="e1"
		model="s1" description="Section 7 - assert as a value - DFDL-7-045R">
		<tdml:document />
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e1>42</e1>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertFail1" root="e2"
		model="s1" description="Section 7 - negative test for assert expression - DFDL-7-043R">
		<tdml:document />
		<tdml:errors>
			<tdml:error>Assertion</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertFail2" root="e3"
		model="s1" description="Section 7 - negative test for assert expression - DFDL-7-043R">
		<tdml:document />
		<tdml:errors>
			<tdml:error>Assertion</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:defineSchema name="choice1">
		<dfdl:format ref="ex:daffodilTest1" />
		<xs:element name="c1">
			<xs:complexType>
				<xs:sequence>
					<xs:element name="v" type="xs:int" dfdl:inputValueCalc="{ 42 }" />
					<xs:element name="c">
						<xs:complexType>
							<xs:choice>
								<xs:element name="a1" type="xs:string"
									dfdl:inputValueCalc="{ 'a1' }">
									<xs:annotation>
										<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
											<dfdl:assert><![CDATA[{ xs:int(../../ex:v) ne 42 }]]></dfdl:assert>
										</xs:appinfo>
									</xs:annotation>
								</xs:element>
								<xs:element name="a2" type="xs:string"
									dfdl:inputValueCalc="{ 'a2' }" />
							</xs:choice>
						</xs:complexType>
					</xs:element>
				</xs:sequence>
			</xs:complexType>
		</xs:element>
	</tdml:defineSchema>

	<tdml:parserTestCase name="assertGuidesChoice"
		root="c1" model="choice1"
		description="Section 7 - assert on an element declaration - DFDL-7-048R">
		<tdml:document />
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<c1>
					<v>42</v>
					<c>
						<a2>a2</a2>
					</c>
				</c1>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertPatternPass" root="e4"
		model="s1" description="Section 7 - assert as a value - DFDL-7-045R">
		<tdml:document><![CDATA[43]]></tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e4>43</e4>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertPatternFail" root="e5"
		model="s1" description="Section 7 - assert as a value - DFDL-7-045R">
		<tdml:document>43</tdml:document>
		<tdml:errors>
			<tdml:error>Assert</tdml:error>
			<tdml:error>pattern</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertPatternPass2"
		root="e6" model="s1"
		description="Section 7 - assert pattern pass multiple assert - DFDL-7-045R">
		<tdml:document>43:</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e6>43</e6>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertPatternFail2"
		root="e6" model="s1"
		description="Section 7 - assert pattern fail multiple assert - DFDL-7-045R">
		<tdml:document>43,</tdml:document>
		<tdml:errors>
			<tdml:error>Assert</tdml:error>
			<tdml:error>pattern</tdml:error>
		</tdml:errors>
	</tdml:parserTestCase>

	<tdml:parserTestCase name="assertPatternPass3"
		root="e7" model="s1"
		description="Section 7 - assert pattern pass multiple assert - DFDL-7-045R">
		<tdml:document>abcDEFG</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e7>abcDEFG</e7>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>
	
	<tdml:parserTestCase name="assertPatternPass4"
		root="e8" model="s1"
		description="Section 7 - assert pattern pass multiple assert - DFDL-7-045R">
		<tdml:document>abcDEFG</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<e8>abcDEFG</e8>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

	<tdml:defineSchema name="literalTextMatch">
		<dfdl:format ref="ex:daffodilTest1" lengthKind="delimited"/>
		<xs:element name="root" >
			<xs:complexType>
				<xs:sequence dfdl:separator="/" dfdl:separatorPosition="prefix"
					dfdl:separatorPolicy="suppressed">
					<xs:element name="e1" type="xs:string" >
						<xs:annotation>
							<xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
								<dfdl:assert testKind="pattern">XYZZY</dfdl:assert>
							</xs:appinfo>
						</xs:annotation>
					</xs:element>
				</xs:sequence>
			</xs:complexType>
		</xs:element>

	</tdml:defineSchema>

	<tdml:parserTestCase name="assertPatternLiteralTextMatch"
		root="root" model="literalTextMatch" description="pattern asserts - DFDL-7-045R">
		<tdml:document>/XYZZY</tdml:document>
		<tdml:infoset>
			<tdml:dfdlInfoset>
				<root><e1>XYZZY</e1></root>
			</tdml:dfdlInfoset>
		</tdml:infoset>
	</tdml:parserTestCase>

</tdml:testSuite>
