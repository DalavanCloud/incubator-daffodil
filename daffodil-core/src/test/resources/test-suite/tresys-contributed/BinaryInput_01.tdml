<?xml version="1.0" encoding="UTF-8"?>
<tdml:testSuite suiteName="binaryInput"
  description="Section 13 - Simple Types of Binary Format" xmlns:tdml="http://www.ibm.com/xmlns/dfdl/testData"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/"
  xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:tns="http://example.com"
  xsi:schemaLocation="http://www.ibm.com/xmlns/dfdl/testData /xsd/tdml.xsd">

  <tdml:defineSchema name="DFDL-307-one-octet.dfdl.xsd">

    <dfdl:format ref="tns:daffodilTest1" representation="binary"
      binaryNumberRep="binary" lengthUnits="bits" byteOrder='bigEndian'
      alignment="1" alignmentUnits="bits" lengthKind='explicit' />

    <xs:element name="is-signed" dfdl:lengthKind="implicit">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="sign" type="xs:unsignedByte"
            dfdl:length="1" />
          <xs:element name="abs" type="xs:unsignedByte"
            dfdl:length="7" />
        </xs:sequence>
      </xs:complexType>
    </xs:element>

    <xs:element name="e1" type="xs:unsignedByte" dfdl:length="1" />

    <xs:element name="e2">
      <xs:complexType>
        <xs:sequence>
          <xs:element name="others" type="xs:unsignedInt"
            dfdl:length="7" />
          <xs:element name="v" type="xs:unsignedByte"
            dfdl:length="1" />

        </xs:sequence>
      </xs:complexType>
    </xs:element>

  </tdml:defineSchema>

  <tdml:parserTestCase name="OneOctetBinaryParse"
    root="is-signed" model="DFDL-307-one-octet.dfdl.xsd" description="Section 13 - Simple Types of Binary Format">
    <tdml:document>
      <tdml:documentPart type="bits">00110000
      </tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <is-signed>
          <sign>0</sign>
          <abs>48</abs>
        </is-signed>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:parserTestCase name="OneBitLeftOver" root="e1"
    model="DFDL-307-one-octet.dfdl.xsd" description="Section 13 - Simple Types of Binary Format">
    <tdml:document>
      <tdml:documentPart type="bits">11</tdml:documentPart>
    </tdml:document>
    <tdml:errors>
      <tdml:error>Left over</tdml:error>
    </tdml:errors>
  </tdml:parserTestCase>

  <tdml:parserTestCase name="OneBit1" root="e1"
    model="DFDL-307-one-octet.dfdl.xsd" description="Section 13 - Simple Types of Binary Format">
    <tdml:document>
      <tdml:documentPart type="bits">1</tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <e1>1</e1>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>

  <tdml:parserTestCase name="OneBit2" root="e2"
    model="DFDL-307-one-octet.dfdl.xsd" description="Section 13 - Simple Types of Binary Format">
    <tdml:document>
      <tdml:documentPart type="bits">00000001
      </tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <e2>
          <others>0</others>
          <v>1</v>
        </e2>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  <tdml:defineSchema name="packed7BitASCII">
  
  <dfdl:format ref="tns:daffodilTest1"
     encoding="US-ASCII-7-bit-packed" lengthUnits="characters"/>
     
  <xs:element name="e1" type="xs:string" dfdl:lengthKind="explicit" dfdl:length="2"/>
  <xs:element name="e2" type="xs:string" dfdl:lengthKind="explicit" dfdl:length="64"/>
  <xs:element name="e3" type="xs:string" dfdl:lengthKind="delimited" dfdl:terminator=","/>
  
  <xs:element name="e4">
    <xs:complexType>
    <xs:choice>
      <xs:element name="d0" type="xs:string" dfdl:terminator="%NUL;" dfdl:lengthKind="delimited">
       <xs:annotation>
       <xs:appinfo source="http://www.ogf.org/dfdl/dfdl-1.0/">
         <!-- 0 to 63 occurrences of not a NUL, followed by a NUL -->
         <dfdl:discriminator testKind="pattern">[^\x00]{0,63}\x00</dfdl:discriminator>
       </xs:appinfo>
       </xs:annotation>
      </xs:element>
      <xs:element name="d1" type="xs:string" dfdl:lengthKind="explicit" dfdl:length="64"/>
    </xs:choice>
    </xs:complexType>
  </xs:element>
  
  </tdml:defineSchema>

<tdml:parserTestCase name="packed7BitASCII1" root="e1"
    model="packed7BitASCII">
    <tdml:document>
      <tdml:documentPart type="bits"><![CDATA[
      0110100 0110010
      ]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <e1>42</e1>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  <tdml:parserTestCase name="packed7BitASCII2" root="e2"
    model="packed7BitASCII">
    <tdml:document>
      <tdml:documentPart type="bits"><![CDATA[
      0110001 0110010 0110011 0110100 0110101 0110110 0110111 0111000 0111001 0110000
      0110001 0110010 0110011 0110100 0110101 0110110 0110111 0111000 0111001 0110000
      0110001 0110010 0110011 0110100 0110101 0110110 0110111 0111000 0111001 0110000
      0110001 0110010 0110011 0110100 0110101 0110110 0110111 0111000 0111001 0110000
      0110001 0110010 0110011 0110100 0110101 0110110 0110111 0111000 0111001 0110000
      0110001 0110010 0110011 0110100 0110101 0110110 0110111 0111000 0111001 0110000
      0110001 0110010 0110011 0110100 
      ]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <e2>1234567890123456789012345678901234567890123456789012345678901234</e2>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  <tdml:parserTestCase name="packed7BitASCII3" root="e3"
    model="packed7BitASCII">
    <tdml:document>
      <tdml:documentPart type="bits"><![CDATA[
      0110001 0101100 
      ]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <e3>1</e3>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  
    <tdml:parserTestCase name="packed7BitASCII4" root="e4"
    model="packed7BitASCII">
    <tdml:document>
      <tdml:documentPart type="bits"><![CDATA[
      0110001 0000000 
      ]]></tdml:documentPart>
    </tdml:document>
    <tdml:infoset>
      <tdml:dfdlInfoset>
        <e4><d0>1</d0></e4>
      </tdml:dfdlInfoset>
    </tdml:infoset>
  </tdml:parserTestCase>
  
  
</tdml:testSuite>